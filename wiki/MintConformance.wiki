#summary This documentation describes how to run the various MINT Conformance Tools.

<wiki:toc max_depth="3" />

= Setting up your environment =

The MINT Conformance tools require [http://www.python.org Python2.5] or later. Currently the tools are run directly from the MINTConformance package in a subversion trunk (installation scripts will be provided later). In order to run the tools, the *PYTHONPATH* environment variable must be set to point to the python source code. The python application must also be in your *PATH*. For example, if *MC_PATH* is the path to your subversion trunk, then set your PYTHONPATH as follows:

*Unix*
{{{
PATH=${PATH}:/pub/python/bin
PYTHONPATH=$MC_HOME/MINTConformance/src
}}}

*Windows*
{{{
set PATH=%PATH%;C:\Python2.6
set PYTHONPATH=%MC_HOME%\MINTConformance\src
}}}

--------------------

= MINTConformance Tools =

The MINTConformance package was developed based on the draft [http://groups.google.com/group/mint-user/files MINT Conformance Test] Power Point specification located in the [http://groups.google.com mint-user Google Group]. It currently consists of three tools.

== Mint Study Compare Shell Script == 

The [http://code.google.com/p/medical-imaging-network-transport/source/browse/trunk/MINTConformance/src/org/nema/medical/mint/MintStudyCompare.sh MintStudyCompare.sh] tool is a simple shell script that compares two MINT studies by running the Unix _diff_ command on the metadata.xml files and the _cmp_ command on each of the binary items. This tool checks that the MINT studies are exactly equal. 

Because we are running directly from the subversion trunk instead on an installation, the permissions on the tools are not executable. Launch the tool by using the Unix _sh_ command to parse the file. To run this script on Windows, it requires a [http://www.cygwin.com/ cyqwin] command shell.

Running the tool with no arguments displays the usage:

{{{
> sh $MC_HOME/MINTConformance/src/org/nema/medical/mint/MintStudyCompare.sh
Usage: MintStudyCompare.sh <mint_study1.xml> <mint_study2.xml>
}}}

To test the tool, you can use the sample data located in the MINTConformance/testdata directory. In the example below, we run the tool with the identical MINT studies so no differences are found. As with most Unix applications, no news is good news. Therefore, no output means the metadata and binary files are exactly equal.

{{{
> cd $MC_HOME/MINTConformance/testdata/MINT/7cc45edf-d5a6-4264-b8ae-1d24d857f04b/DICOM
> sh $MC_HOME/MINTConformance/src/org/nema/medical/mint/MintStudyCompare.sh metadata.xml metadata.xml
}}}

To see differences, we can compare an older MINT study to a newer one. The example below shows both metadata changes and binary differences.

{{{
> cd $MC_HOME/MINTConformance/testdata/MINT
> sh $MC_HOME/MINTConformance/src/org/nema/medical/mint/MintStudyCompare.sh metadata.1.xml 7cc45edf-d5a6-4264-b8ae-1d24d857f04b/DICOM/metadata.xml
1,190c1,190
< <?xml version="1.0" encoding="utf-8" ?>
< <StudyMeta studyInstanceUID="1.2.392.200036.9116.2.2.2.1762893313.1029997326.945873">
<     <Attributes>
<         <Attr tag="00080020" vr="DA" val="20020711" />
<         <Attr tag="00080030" vr="TM" val="144114.000" />
<         <Attr tag="00080050" vr="SH" val="1126" />
...
./binaryitems/2.dat 7cc45edf-d5a6-4264-b8ae-1d24d857f04b/DICOM/binaryitems/2.dat differ: byte 759, line 4
}}}

== Mint Study Compare Python Application ==

The [http://code.google.com/p/medical-imaging-network-transport/source/browse/trunk/MINTConformance/src/org/nema/medical/mint/MintStudyCompare.py  MintStudyCompare.py] tool is a smart python application that compares two MINT studies by parsing the metadata.xml files and doing a byte by byte comparison for each of the binary items. This tool checks that the MINT studies are equivalent and is tolerant to minor formatting differences and attribute sorting.

Launch the tool by using the _python_ command to parse the file. This tool should run either in a Unix or Windows command shell.

Running the tool with no arguments displays the usage:

{{{
> python $MC_HOME/MINTConformance/src/org/nema/medical/mint/MintStudyCompare.py
Usage: MintStudyCompare.py [options] <mint_study1.xml> <mint_study2.xml>
  -v: verbose
  -l: lazy check (skips binary content)
  -h: displays usage
}}}

The verbose flag turns on output to show how many tags and bytes were compared. Otherwise nothing is displayed when there are no differences. You can optionally skip checking the binary to save time when debugging. 

{{{
> cd $MC_HOME/MINTConformance/testdata/MINT/7cc45edf-d5a6-4264-b8ae-1d24d857f04b/DICOM
> python $MC_HOME/MINTConformance/src/org/nema/medical/mint/MintStudyCompare.py -v metadata.xml metadata.xml
        12 study attribute(s) compared.
         2 series compared.
        14 series attribute(s) compared.
       102 normalized instance attribute(s) compared.
         4 instance(s) compared.
        24 instance attribute(s) compared.
         4 binary item(s) compared.
   2097152 byte(s) compared.
}}}

To see all the differences the application should be run twice, switching the command line arguments. This will find all the tags that may be present in one study but not the other.

{{{
> cd $MC_HOME/MINTConformance/testdata/MINT
> python $MC_HOME/MINTConformance/src/org/nema/medical/mint/MintStudyCompare.py 7cc45edf-d5a6-4264-b8ae-1d24d857f04b/DICOM/metadata.xml metadata.2.xml
Series (1.2.392.200036.9116.2.2.2.1762893313.1029997326.946350) Normalized Instance Attribute : tag=00080008 vr=CS val=ORIGINAL\PRIMARY\AXIAL != tag=00080008 vr=CS val=ORIGINAL
Series (1.2.392.200036.9116.2.2.2.1762893313.1029997326.946350) Normalized Instance Attribute : tag=00200020 vr=CS val=L\P != tag=00200020 vr=CS val=L
Series (1.2.392.200036.9116.2.2.2.1762893313.1029997326.946350) Normalized Instance Attribute : tag=00200037 vr=DS val=1.000000\0.000000\0.000000\0.000000\1.000000\0.000000 != tag=00200037 vr=DS val=1.000000
...
2.dat size : 524288 != 524287
        12 study attribute(s) compared.
         2 series compared.
        14 series attribute(s) compared.
       102 normalized instance attribute(s) compared.
         4 instance(s) compared.
        24 instance attribute(s) compared.
         4 binary item(s) compared.
   1572864 byte(s) compared.
17 difference(s) found.
}}}

== Mint Dicom Compare Python Application ==

The [http://code.google.com/p/medical-imaging-network-transport/source/browse/trunk/MINTConformance/src/org/nema/medical/mint/MintDicomCompare.py MintDicomCompare.py] tool is a smart python application that compares a DICOM study to a MINT study by parsing the data elements in the DICOM and comparing them to the metadata and binary items in the MINT study.

Launch the tool by using the _python_ command to parse the file. This tool should run either in a Unix or Windows command shell.

Running the tool with no arguments displays the usage:

{{{
> python $MC_HOME/MINTConformance/src/org/nema/medical/mint/MintDicomCompare.py
Usage: MintDicomCompare.py [options] <dicom_study_dir> <mint_study.xml>
  -v: verbose
  -l: lazy check (skips binary content)
  -h: displays usage
}}}

The verbose flag turns on output to show how many tags and bytes were compared. Otherwise nothing is displayed when there are no differences. You can optionally skip checking the binary to save time when debugging. 

{{{
> cd $MC_HOME/MINTConformance/testdata
> python $MC_HOME/MINTConformance/src/org/nema/medical/mint/MintDicomCompare.py -v DICOM MINT/7cc45edf-d5a6-4264-b8ae-1d24d857f04b/DICOM/metadata.xml
- Study Instance UID 1.2.392.200036.9116.2.2.2.1762893313.1029997326.945873
 - Series Instance UID 1.2.392.200036.9116.2.2.2.1762893313.1029997326.946350
  - SOP Instance UID 1.2.392.200036.9116.2.2.2.1762660474.1026398161.357037
+++ 00280002 Value :  != 1
- Study Instance UID 1.2.392.200036.9116.2.2.2.1762893313.1029997326.945873
 - Series Instance UID 1.2.392.200036.9116.2.2.2.1762893313.1029997326.946350
  - SOP Instance UID 1.2.392.200036.9116.2.2.2.1762660474.1026398161.357037
+++ 00280006 Value :  != 0
- Study Instance UID 1.2.392.200036.9116.2.2.2.1762893313.1029997326.945873
 - Series Instance UID 1.2.392.200036.9116.2.2.2.1762893313.1029997326.946350
  - SOP Instance UID 1.2.392.200036.9116.2.2.2.1762660474.1026398161.357037
+++ 00280010 Value : 
...
         4 instance(s) compared.
        32 tag(s) skipped.
       300 text tag(s) compared.
         4 binary tag(s) compared.
   2097152 byte(s) compared.
        32 difference(s) found.
}}}

--------------------

= Next Steps =

*Done*

   * Resolve binary/text differences between DICOM and MINT
   * Revisit Part 10 header differences between DICOM and MINT
   * Parse sequencing data elements (SQ) in MintStudy
   * Compare sequencing data elements (SQ) between MINT studies
   * Parse sequencing data elements (SQ) in DICOM 
   * Detect endianness, explicit VRs

*To Do*

   * Compare sequencing data elements (SQ) between DICOM and MINT
   * Provide support for inline binary
   * Use DCM4CHE data dictionary
   * Provide support for bulk binary
   * SAX parsing for large metadata files (?)
   * Comparisons before and after updates
   * Support multi-frame DICOM